<!DOCTYPE html>
<html lang='ar' dir='rtl'>
<head>
    <meta charset='UTF-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุงูุชุญูู - ูุณูู ูุงูู ุจุฑู</title>
    <link rel="stylesheet" href="styles/style.css">
    
    <script src="js/protection.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        /* ุฃููุงุท ุฅุถุงููุฉ ูููุญุฉ ุงูุชุญูู */
        .protected-badge {
            background: #28a745;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .encryption-status {
            background: #343a40;
            color: #17a2b8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .security-alert {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        /* ุฃููุงุท ูุธุงู ุงูุงูุชุฑุงุญุงุช ุงูุชููุงุฆูุฉ */
        .suggestions-box {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            width: calc(100% - 2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 2px;
        }

        .suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #eee;
        }
        
        .suggestion-item:hover {
            background-color: #f0f0f0;
        }
        
        .suggestion-item img {
            width: 24px;
            height: 24px;
            margin-left: 10px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="protection-message" style="display:none; background:red; color:white; padding:15px; text-align:center;">
        <h3>โ ุงููุตูู ููููุน</h3>
        <p>ููุญุฉ ุงูุชุญูู ุบูุฑ ูุชุงุญุฉ ูู ูุฐุง ุงููุทุงู</p>
    </div>

    <div id="main-content">
        <h2>ููุญุฉ ุชุญูู - ูุณูู ูุงูู ุจุฑู <span class="protected-badge">ูุญูู</span></h2>

        <div class="security-alert">
            <strong>๐ ูุธุงู ุงูุญูุงูุฉ ูุดุท:</strong> ูุชู ุชุดููุฑ ุฌููุน ุงูุจูุงูุงุช ูุจู ุญูุธูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
        </div>

        <div class="container">
            <div id="login-section" class="form-container">
                <h3>ุชุณุฌูู ุงูุฏุฎูู ููุฅุฏุงุฑุฉ</h3>
                <div class="encryption-status">
                    ๐ ุงููููุน ุงูุญุงูู: <strong id="current-domain"></strong>
                </div>
                <form id="login-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                            <input type="email" id="email" required value="www735981122@gmail.com">
                        </div>
                        <div class="form-group">
                            <label for="password">ูููุฉ ุงููุฑูุฑ</label>
                            <input type="password" id="password" required placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ">
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="submit" class="btn btn-primary">ุชุณุฌูู ุงูุฏุฎูู</button>
                    </div>
                    <div id="login-message"></div>
                </form>
            </div>

            <div id="dashboard-section" class="hidden">
                <div class="form-container">
                    <h3 id="form-title">ุฅุถุงูุฉ ูุจุงุฑุงุฉ ุฌุฏูุฏุฉ <span class="protected-badge">ูุดูุฑุฉ</span></h3>
                    
                    <div class="encryption-status">
                        ๐ ุงููููุน: <strong id="encryption-domain"></strong><br>
                        ๐๏ธ ููุชุงุญ ุงูุชุดููุฑ: <span id="encryption-key-preview"></span>
                    </div>
                    
                    <form id="match-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="league">ุงูุฏูุฑู/ุงูุจุทููุฉ</label>
                                <input type="text" id="league" required data-type="league">
                                <div id="league-suggestions" class="suggestions-box"></div>
                            </div>
                            <div class="form-group">
                                <label for="league-logo">ุดุนุงุฑ ุงูุฏูุฑู (URL)</label>
                                <input type="url" id="league-logo" required placeholder="ุดุนุงุฑ ุงูุฏูุฑู">
                                <img id="league-preview" src="https://resources.premierleague.com/premierleague/badges/50/t1.png" alt="ุดุนุงุฑ ุงูุฏูุฑู" class="logo-preview">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="team1">ุงููุฑูู ุงูุฃูู</label>
                                <input type="text" id="team1" required data-type="team1">
                                <div id="team1-suggestions" class="suggestions-box"></div>
                            </div>
                            <div class="form-group">
                                <label for="team1-logo">ุดุนุงุฑ ุงููุฑูู ุงูุฃูู (URL)</label>
                                <input type="url" id="team1-logo" required placeholder="ุดุนุงุฑ ุงููุฑูู ุงูุฃูู">
                                <img id="team1-preview" src="https://via.placeholder.com/40?text=T1" alt="ุดุนุงุฑ ุงููุฑูู ุงูุฃูู" class="logo-preview">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="team2">ุงููุฑูู ุงูุซุงูู</label>
                                <input type="text" id="team2" required data-type="team2">
                                <div id="team2-suggestions" class="suggestions-box"></div>
                            </div>
                            <div class="form-group">
                                <label for="team2-logo">ุดุนุงุฑ ุงููุฑูู ุงูุซุงูู (URL)</label>
                                <input type="url" id="team2-logo" required placeholder="ุดุนุงุฑ ุงููุฑูู ุงูุซุงูู">
                                <img id="team2-preview" src="https://via.placeholder.com/40?text=T2" alt="ุดุนุงุฑ ุงููุฑูู ุงูุซุงูู" class="logo-preview">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="match-date">ุชุงุฑูุฎ ุงููุจุงุฑุงุฉ</label>
                                <input type="date" id="match-date" required>
                            </div>
                            <div class="form-group">
                                <label for="match-time">ุชูููุช ุงููุจุงุฑุงุฉ</label>
                                <input type="time" id="match-time" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="channel">ุงูููุงุฉ ุงููุงููุฉ</label>
                                <input type="text" id="channel" required>
                            </div>
                            <div class="form-group">
                                <label for="commentator">ุงููุนูู</label>
                                <input type="text" id="commentator">
                            </div>
                        </div>
                        
                        <div class="form-row link-type-selection">
                            <label>ููุน ุงูุฑูุงุจุท:</label>
                            <button type="button" class="btn btn-sm link-type-btn active" data-type="regular">ุฑูุงุจุท ูุชุนุฏุฏุฉ</button>
                            <button type="button" class="btn btn-sm link-type-btn" data-type="xmtv">ุฑุงุจุท XM TV</button>
                        </div>
                        
                        <div id="regular-links-section" class="link-section active">
                            <div class="form-group">
                                <label for="links">ุฑูุงุจุท ุงูุจุซ (ูู ุฑุงุจุท ูู ุณุทุฑ)</label>
                                <textarea id="links" rows="5" placeholder="ุถุน ุฑูุงุจุท ุงูุจุซ ููุงุ ุฑุงุจุท ูุงุญุฏ ูู ูู ุณุทุฑ."></textarea>
                            </div>
                        </div>
                        
                        <div id="xmtv-links-section" class="link-section hidden">
                            <div class="form-group">
                                <label for="xmtv-link">ุฑุงุจุท XM TV (ุฑุงุจุท ูุงุญุฏ ููุท)</label>
                                <input type="url" id="xmtv-link" placeholder="ุฃุฏุฎู ุฑุงุจุท XM TV ูุงููุงู">
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary" id="submit-btn">ุฅุถุงูุฉ ุงููุจุงุฑุงุฉ ุงููุดูุฑุฉ</button>
                            <button type="button" class="btn btn-danger hidden" id="cancel-btn">ุฅูุบุงุก ุงูุชุนุฏูู</button>
                            <button type="button" class="btn btn-secondary" id="logout-btn">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
                            <a href="index.html" class="btn btn-success">ุนุฑุถ ุงููููุน</a>
                            <button type="button" class="btn btn-info" onclick="testEncryption()">ุงุฎุชุจุงุฑ ุงูุชุดููุฑ</button>
                        </div>
                        <div id="form-message"></div>
                    </form>
                </div>

                <div class="matches-container">
                    <h3>ุงููุจุงุฑูุงุช ุงููุถุงูุฉ <span class="protected-badge" id="db-status">ุฌุงุฑู ุงูุงุชุตุงู...</span></h3>
                    <div id="matches-list">
                        <div class="loading">ุฌุงุฑู ุชุญููู ุงููุจุงุฑูุงุช...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ุงููุชุบูุฑุงุช ุงูุนุงูุฉ
        const loginSection = document.getElementById('login-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const loginForm = document.getElementById('login-form');
        const loginMessage = document.getElementById('login-message');
        const matchForm = document.getElementById('match-form');
        const formMessage = document.getElementById('form-message');
        const submitBtn = document.getElementById('submit-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const matchesList = document.getElementById('matches-list');
        const regularLinksSection = document.getElementById('regular-links-section');
        const xmtvLinksSection = document.getElementById('xmtv-links-section');
        
        let currentEditId = null;
        
        // ุงูุชุญูู ูู ุงููุทุงู ุฃููุงู
        document.addEventListener('DOMContentLoaded', function() {
            const protector = window.DataProtector;
            const currentDomain = window.location.hostname;
            
            document.getElementById('current-domain').textContent = currentDomain;
            
            // ุงูุชุญูู ูู ุฃู ุงููุทุงู ูุณููุญ ูููุญุฉ ุงูุชุญูู
            const allowedAdminDomains = ['localhost', '127.0.0.1'];
            if (!allowedAdminDomains.includes(currentDomain) && !currentDomain.includes('github.io') && !currentDomain.includes('netlify.app')) {
                document.getElementById('protection-message').style.display = 'block';
                document.getElementById('main-content').style.display = 'none';
                console.error("๐จ ููุญุฉ ุงูุชุญูู ุบูุฑ ูุณููุญุฉ ูู ูุฐุง ุงููุทุงู:", currentDomain);
                return;
            }
            
            // ุนุฑุถ ูุนูููุงุช ุงูุชุดููุฑ
            if (protector) {
                document.getElementById('encryption-domain').textContent = currentDomain;
                const keyPreview = protector.secretKey.substring(0, 10) + '...';
                document.getElementById('encryption-key-preview').textContent = keyPreview;
            }
            
            // ุชููุฆุฉ ูุธุงู ุงูุชุนุจุฆุฉ ุงูุชููุงุฆูุฉ
            setupAutoLogoFill();
            
            // ุฅุนุฏุงุฏ ูุญููุงุช ููุน ุงูุฑุงุจุท
            document.querySelectorAll('.link-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.link-type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const type = this.getAttribute('data-type');
                    
                    regularLinksSection.classList.add('hidden');
                    xmtvLinksSection.classList.add('hidden');
                    
                    if (type === 'regular') {
                        regularLinksSection.classList.remove('hidden');
                    } else if (type === 'xmtv') {
                        xmtvLinksSection.classList.remove('hidden');
                    }
                });
            });
            
            // ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุชููุงุฆูุงู ุจุนุฏ ุชุญููู ุงูุตูุญุฉ
            setTimeout(() => {
                window.testFirebaseConnection();
            }, 2000);
        });

        // ุฅุนุฏุงุฏุงุช Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCqE7ZwveHg1dIhYf1Hlo7OpHyCZudeZvM",
            authDomain: "wacel-live.firebaseapp.com",
            databaseURL: "https://wacel-live-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "wacel-live",
            storageBucket: "wacel-live.firebasestorage.app",
            messagingSenderId: "185108554006",
            appId: "1:185108554006:web:93171895b1d4bb07c6f037"
        };

        // ุชููุฆุฉ Firebase
        let firebaseApp, firebaseDb, firebaseAuth;
        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            firebaseDb = firebase.database();
            firebaseAuth = firebase.auth();
            console.log("โ ุชู ุชููุฆุฉ Firebase ุจูุฌุงุญ ูู admin.html");
            document.getElementById('db-status').textContent = 'ูุชุตู';
            document.getElementById('db-status').style.backgroundColor = '#28a745';
        } catch (error) {
            console.error("โ ุฎุทุฃ ูู ุชููุฆุฉ Firebase:", error);
            document.getElementById('db-status').textContent = 'ุบูุฑ ูุชุตู';
            document.getElementById('db-status').style.backgroundColor = '#dc3545';
        }

        // ุฏุงูุฉ ูุงุฎุชุจุงุฑ ุงูุงุชุตุงู
        window.testFirebaseConnection = function() {
            if (firebaseDb) {
                firebaseDb.ref('test_connection').once('value')
                    .then(() => {
                        console.log("โ ุงุฎุชุจุงุฑ ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงุฌุญ.");
                        document.getElementById('db-status').textContent = 'ูุชุตู';
                        document.getElementById('db-status').style.backgroundColor = '#28a745';
                    })
                    .catch(error => {
                        console.error("โ ูุดู ุงุฎุชุจุงุฑ ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช:", error);
                        document.getElementById('db-status').textContent = 'ูุดู ุงูุงุชุตุงู';
                        document.getElementById('db-status').style.backgroundColor = '#dc3545';
                    });
            }
        };

        // ุฏุงูุฉ ูุงุฎุชุจุงุฑ ุงูุชุดููุฑ
        window.testEncryption = function() {
            const protector = window.DataProtector;
            if (!protector) {
                alert("โ ูุธุงู ุงูุญูุงูุฉ ุบูุฑ ูุญูู");
                return;
            }
            
            const testText = "https://example.com/test-stream";
            console.log("๐ ุงุฎุชุจุงุฑ ุงูุชุดููุฑ:");
            console.log("ุงููุต ุงูุฃุตูู:", testText);
            
            const encrypted = protector.encryptData(testText);
            console.log("ุงููุต ุงููุดูุฑ:", encrypted);
            
            const decrypted = protector.decryptData(encrypted);
            console.log("ุงููุต ุจุนุฏ ูู ุงูุชุดููุฑ:", decrypted);
            
            alert(`โ ุงุฎุชุจุงุฑ ุงูุชุดููุฑ ูุงุฌุญ!\n\nุงูุฃุตู: ${testText}\nุงููุดูุฑ: ${encrypted}\nุจุนุฏ ูู ุงูุชุดููุฑ: ${decrypted}`);
        };

        // --------------------------------------------------
        // ูุธุงุฆู ุงููุงุฌูุฉ ูุงูุชุณุฌูู
        // --------------------------------------------------

        // ุนุฑุถ ุงูุฑุณุงุฆู
        function showMessage(element, message, type) {
            element.innerHTML = `<div class="${type}">${message}</div>`;
            setTimeout(() => {
                element.innerHTML = '';
            }, 5000);
        }

        // ุชุญุฏูุซ ุญุงูุฉ ุงููุงุฌูุฉ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู/ุงูุฎุฑูุฌ
        function updateUI(user) {
            if (user) {
                loginSection.classList.add('hidden');
                dashboardSection.classList.remove('hidden');
                if (firebaseDb) {
                    firebaseDb.ref('matches').on('value', displayMatchesInAdmin, function(error) {
                        console.error("ุฎุทุฃ ูู ูุฑุงุกุฉ ุงููุจุงุฑูุงุช:", error);
                        matchesList.innerHTML = '<div class="error">โ ูุดู ุชุญููู ุงููุจุงุฑูุงุช.</div>';
                    });
                }
                console.log("๐ค ุงููุณุชุฎุฏู ูุณุฌู ุงูุฏุฎูู:", user.email);
            } else {
                loginSection.classList.remove('hidden');
                dashboardSection.classList.add('hidden');
                if (firebaseDb) {
                    firebaseDb.ref('matches').off('value', displayMatchesInAdmin);
                }
                console.log("๐ค ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ุงูุฏุฎูู.");
            }
        }
        
        // ุงูุชุญูู ูู ุญุงูุฉ ุงููุตุงุฏูุฉ ุนูุฏ ุงูุชุญููู
        if (firebaseAuth) {
            firebaseAuth.onAuthStateChanged(updateUI);
        }

        // ุฅุฑุณุงู ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            firebaseAuth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    showMessage(loginMessage, "โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ!", "success");
                })
                .catch((error) => {
                    showMessage(loginMessage, `โ ุฎุทุฃ ูู ุชุณุฌูู ุงูุฏุฎูู: ${error.message}`, "error");
                });
        });

        // ุชุณุฌูู ุงูุฎุฑูุฌ
        logoutBtn.addEventListener('click', function() {
            firebaseAuth.signOut().then(() => {
                showMessage(loginMessage, "โ ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุจูุฌุงุญ.", "success");
            }).catch((error) => {
                console.error("ุฎุทุฃ ูู ุชุณุฌูู ุงูุฎุฑูุฌ:", error);
            });
        });

        // --------------------------------------------------
        // ูุธุงุฆู ุงููููุฐุฌ ูุงูุชุดููุฑ
        // --------------------------------------------------

        // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
        function resetForm() {
            matchForm.reset();
            currentEditId = null;
            document.getElementById('form-title').textContent = 'ุฅุถุงูุฉ ูุจุงุฑุงุฉ ุฌุฏูุฏุฉ';
            submitBtn.textContent = "ุฅุถุงูุฉ ุงููุจุงุฑุงุฉ ุงููุดูุฑุฉ";
            cancelBtn.classList.add('hidden');
            
            // ุฅุนุงุฏุฉ ุชุนููู ููุน ุงูุฑูุงุจุท ุฅูู ุงูุงูุชุฑุงุถู
            document.querySelectorAll('.link-type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-type') === 'regular') {
                    btn.classList.add('active');
                }
            });
            regularLinksSection.classList.remove('hidden');
            xmtvLinksSection.classList.add('hidden');
            
            // ุชุญุฏูุซ ูุนุงููุงุช ุงูุดุนุงุฑุงุช ุฅูู ุงูููู ุงูุงูุชุฑุงุถูุฉ
            document.getElementById('team1-preview').src = 'https://via.placeholder.com/40?text=T1';
            document.getElementById('team2-preview').src = 'https://via.placeholder.com/40?text=T2';
            document.getElementById('league-preview').src = 'https://resources.premierleague.com/premierleague/badges/50/t1.png';
        }
        
        // ุฏุงูุฉ ุงูุชุญุฑูุฑ
        window.editMatch = function(matchId, encryptedMatch) {
            const protector = window.DataProtector;
            if (!protector) {
                alert("โ ูุธุงู ุงูุญูุงูุฉ ุบูุฑ ูุญูู!");
                return;
            }
            
            const match = protector.decryptMatch(encryptedMatch);
            
            // ููุก ุงููููุฐุฌ ุจุจูุงูุงุช ุงููุจุงุฑุงุฉ
            document.getElementById('league').value = match.league;
            document.getElementById('league-logo').value = match.leagueLogo;
            document.getElementById('team1').value = match.team1;
            document.getElementById('team1-logo').value = match.team1Logo;
            document.getElementById('team2').value = match.team2;
            document.getElementById('team2-logo').value = match.team2Logo;
            document.getElementById('match-time').value = match.time;
            document.getElementById('channel').value = match.channel;
            document.getElementById('commentator').value = match.commentator || '';
            document.getElementById('match-date').value = match.date;

            // ุชุญุฏูุซ ุงููุนุงููุงุช
            document.getElementById('league-preview').src = match.leagueLogo;
            document.getElementById('team1-preview').src = match.team1Logo;
            document.getElementById('team2-preview').src = match.team2Logo;
            
            // ุชุญุฏูุซ ููุน ุงูุฑุงุจุท ูุงููููุฉ
            document.querySelectorAll('.link-type-btn').forEach(btn => btn.classList.remove('active'));
            const activeLinkBtn = document.querySelector(`.link-type-btn[data-type="${match.linkType || 'regular'}"]`);
            if (activeLinkBtn) {
                activeLinkBtn.classList.add('active');
            }

            regularLinksSection.classList.add('hidden');
            xmtvLinksSection.classList.add('hidden');
            
            if (match.linkType === 'xmtv') {
                document.getElementById('xmtv-link').value = match.xmtvLink || '';
                xmtvLinksSection.classList.remove('hidden');
            } else {
                document.getElementById('links').value = (match.links || []).join('\n');
                regularLinksSection.classList.remove('hidden');
            }
            
            // ุชุญุฏูุซ ุญุงูุฉ ุงูุชุนุฏูู
            currentEditId = matchId;
            document.getElementById('form-title').textContent = 'ุชุนุฏูู ุงููุจุงุฑุงุฉ';
            submitBtn.textContent = "ุชุญุฏูุซ ุงููุจุงุฑุงุฉ ุงููุดูุฑุฉ";
            cancelBtn.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        
        // ุฏุงูุฉ ุงูุญุฐู
        window.deleteMatch = function(matchId) {
            if (confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงููุจุงุฑุงุฉ ุงููุดูุฑุฉุ")) {
                firebaseDb.ref('matches/' + matchId).remove()
                    .then(() => {
                        showMessage(formMessage, "โ ุชู ุญุฐู ุงููุจุงุฑุงุฉ ุงููุดูุฑุฉ ุจูุฌุงุญ!", "success");
                        resetForm();
                    })
                    .catch(error => {
                        showMessage(formMessage, "โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู: " + error.message, "error");
                    });
            }
        };

        // ุฅุฑุณุงู ูููุฐุฌ ุงููุจุงุฑุงุฉ (ูุนุฏู ููุชุดููุฑ)
        matchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const protector = window.DataProtector;
            if (!firebaseAuth || !firebaseAuth.currentUser) {
                showMessage(formMessage, "โ ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู", "error");
                return;
            }
            
            if (!firebaseDb) {
                showMessage(formMessage, "โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ", "error");
                return;
            }
            
            if (!protector) {
                showMessage(formMessage, "โ ูุธุงู ุงูุญูุงูุฉ ุบูุฑ ูุดุทุ ูุง ูููู ุงูุชุดููุฑ!", "error");
                return;
            }
            
            // ุฌูุน ุงูุจูุงูุงุช ูู ุงููููุฐุฌ
            const rawMatchData = {
                league: document.getElementById('league').value,
                leagueLogo: document.getElementById('league-logo').value,
                team1: document.getElementById('team1').value,
                team1Logo: document.getElementById('team1-logo').value,
                team2: document.getElementById('team2').value,
                team2Logo: document.getElementById('team2-logo').value,
                time: document.getElementById('match-time').value,
                channel: document.getElementById('channel').value,
                commentator: document.getElementById('commentator').value,
                date: document.getElementById('match-date').value,
                linkType: document.querySelector('.link-type-btn.active').getAttribute('data-type'),
                createdAt: Date.now()
            };
            
            // ุฅุถุงูุฉ ุงูุฑูุงุจุท ุญุณุจ ุงูููุน
            const activeLinkType = rawMatchData.linkType;
            if (activeLinkType === 'regular') {
                const linksText = document.getElementById('links').value;
                rawMatchData.links = linksText.split('\n').filter(link => link.trim() !== '');
            } else if (activeLinkType === 'xmtv') {
                rawMatchData.xmtvLink = document.getElementById('xmtv-link').value.trim();
            }
            
            console.log("๐ ุงูุจูุงูุงุช ุงูุฃุตููุฉ ูุจู ุงูุชุดููุฑ:", rawMatchData);
            
            // ๐ ุชุดููุฑ ุงูุจูุงูุงุช ูุจู ุงูุฅุฑุณุงู
            const encryptedMatchData = protector.encryptMatch(rawMatchData);
            
            console.log("๐ ุงูุจูุงูุงุช ุงููุดูุฑุฉ ููุฅุฑุณุงู:", encryptedMatchData);
            
            submitBtn.disabled = true;
            submitBtn.textContent = currentEditId ? "ุฌุงุฑู ุงูุชุดููุฑ ูุงูุชุญุฏูุซ..." : "ุฌุงุฑู ุงูุชุดููุฑ ูุงูุญูุธ...";
            
            if (currentEditId) {
                // ุชุญุฏูุซ ูุจุงุฑุงุฉ ููุฌูุฏุฉ
                firebaseDb.ref('matches/' + currentEditId).update(encryptedMatchData)
                    .then(() => {
                        showMessage(formMessage, "โ ุชู ุชุญุฏูุซ ุงููุจุงุฑุงุฉ ุงููุดูุฑุฉ ุจูุฌุงุญ!", "success");
                        resetForm();
                    })
                    .catch(error => {
                        showMessage(formMessage, "โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุญุฏูุซ: " + error.message, "error");
                    })
                    .finally(() => {
                        submitBtn.disabled = false;
                        submitBtn.textContent = "ุชุญุฏูุซ ุงููุจุงุฑุงุฉ ุงููุดูุฑุฉ";
                    });
            } else {
                // ุฅุถุงูุฉ ูุจุงุฑุงุฉ ุฌุฏูุฏุฉ
                firebaseDb.ref('matches').push(encryptedMatchData)
                    .then((result) => {
                        showMessage(formMessage, "โ ุชู ุฅุถุงูุฉ ุงููุจุงุฑุงุฉ ุงููุดูุฑุฉ ุจูุฌุงุญ!", "success");
                        resetForm();
                    })
                    .catch(error => {
                        showMessage(formMessage, "โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุถุงูุฉ: " + error.message, "error");
                    })
                    .finally(() => {
                        submitBtn.disabled = false;
                        submitBtn.textContent = "ุฅุถุงูุฉ ุงููุจุงุฑุงุฉ ุงููุดูุฑุฉ";
                    });
            }
        });

        // ุฒุฑ ุฅูุบุงุก ุงูุชุนุฏูู
        cancelBtn.addEventListener('click', resetForm);

        // --------------------------------------------------
        // ุนุฑุถ ุงููุจุงุฑูุงุช (ูุน ูู ุงูุชุดููุฑ)
        // --------------------------------------------------

        // ุฏุงูุฉ ุนุฑุถ ุงููุจุงุฑูุงุช ูู ููุญุฉ ุงูุชุญูู (ูุน ูู ุงูุชุดููุฑ)
        function displayMatchesInAdmin(snapshot) {
            matchesList.innerHTML = '';
            
            if (!snapshot.exists()) {
                matchesList.innerHTML = '<div class="loading">ูุง ุชูุฌุฏ ูุจุงุฑูุงุช ูุถุงูุฉ</div>';
                return;
            }
            
            const protector = window.DataProtector;
            if (!protector) {
                matchesList.innerHTML = '<div class="security-alert">โ ูุง ูููู ุนุฑุถ ุงููุจุงุฑูุงุช! ูุธุงู ุงูุญูุงูุฉ/ูู ุงูุชุดููุฑ ุบูุฑ ูุญูู.</div>';
                return;
            }
            
            const matchesArray = [];
            snapshot.forEach(function(childSnapshot) {
                const matchId = childSnapshot.key;
                const encryptedMatch = childSnapshot.val();
                
                try {
                    // ูู ุชุดููุฑ ุงูุจูุงูุงุช ููุนุฑุถ
                    const match = protector.decryptMatch(encryptedMatch);
                    match.id = matchId;
                    match.isEncrypted = encryptedMatch.encrypted === true;
                    match.encryptedData = encryptedMatch; // ุญูุธ ุงูุจูุงูุงุช ุงููุดูุฑุฉ ููุฑูุฑูุง ุฅูู ุฏุงูุฉ ุงูุชุนุฏูู
                    matchesArray.push(match);
                } catch (e) {
                    console.error("โ ูุดู ูู ุชุดููุฑ ุงููุจุงุฑุงุฉ:", matchId, e);
                    matchesArray.push({
                        id: matchId,
                        isEncrypted: false, // ุงูุชุฑุงุถ ูุบูุฑ ุงููุดูุฑุฉ ุฃู ุงููุงุดูุฉ
                        team1: 'ุฎุทุฃ ูู ูู ุงูุชุดููุฑ',
                        team2: 'ุงูุจูุงูุงุช ุชุงููุฉ',
                        league: '---',
                        time: '---',
                        date: '---',
                        channel: '---',
                        encryptedData: encryptedMatch
                    });
                }
            });

            // ุนูุณ ุชุฑุชูุจ ุงููุจุงุฑูุงุช ูุนุฑุถ ุงูุฃุญุฏุซ ุฃููุงู
            matchesArray.reverse();
            
            matchesArray.forEach(match => {
                const encryptionStatus = match.isEncrypted ? 
                    '<span class="protected-badge">ูุดูุฑุฉ</span>' : 
                    '<span class="protected-badge" style="background-color:#dc3545;">ุบูุฑ ูุดูุฑุฉ!</span>';

                const matchElement = document.createElement('div');
                matchElement.className = 'match-item';
                matchElement.innerHTML = `
                    <div class="match-header">
                        <img src="${match.leagueLogo || 'https://via.placeholder.com/30'}" alt="ุดุนุงุฑ ุงูุฏูุฑู" class="league-logo">
                        <span class="league-name">${match.league} ${encryptionStatus}</span>
                        <div class="match-time">${match.date} | ${match.time}</div>
                    </div>
                    <div class="match-teams">
                        <div class="team">
                            <img src="${match.team1Logo || 'https://via.placeholder.com/40'}" alt="${match.team1}" class="team-logo">
                            <span class="team-name">${match.team1}</span>
                        </div>
                        <span class="vs">ููุงุจู</span>
                        <div class="team">
                            <img src="${match.team2Logo || 'https://via.placeholder.com/40'}" alt="${match.team2}" class="team-logo">
                            <span class="team-name">${match.team2}</span>
                        </div>
                    </div>
                    <div class="match-details">
                        ุงูููุงุฉ: <strong>${match.channel}</strong> | ุงููุนูู: <strong>${match.commentator || 'ุบูุฑ ูุญุฏุฏ'}</strong>
                    </div>
                    <div class="match-actions">
                        <button class="btn btn-warning btn-sm" onclick='window.editMatch("${match.id}", ${JSON.stringify(match.encryptedData)})'>ุชุนุฏูู</button>
                        <button class="btn btn-danger btn-sm" onclick='window.deleteMatch("${match.id}")'>ุญุฐู</button>
                    </div>
                `;
                matchesList.appendChild(matchElement);
            });
        }
    </script>
    
    <script>
        // teams-database.js - ุฅุฏุฑุงุฌู ููุง ููุง ูู
        const TEAMS_DATABASE = {
            "ุงูุฏูุฑู ุงูุฅูุฌููุฒู ุงูููุชุงุฒ": {
                "leagueLogo": "https://resources.premierleague.com/premierleague/badges/50/t1.png",
                "teams": {
                    "ูููุฑุจูู": "https://resources.premierleague.com/premierleague/badges/50/t14.png",
                    "ูุงูุดุณุชุฑ ุณูุชู": "https://resources.premierleague.com/premierleague/badges/50/t43.png",
                    "ุฃุฑุณูุงู": "https://resources.premierleague.com/premierleague/badges/50/t3.png",
                    "ุชุดููุณู": "https://resources.premierleague.com/premierleague/badges/50/t8.png",
                    "ูุงูุดุณุชุฑ ูููุงูุชุฏ": "https://resources.premierleague.com/premierleague/badges/50/t1.png"
                }
            },
            "ุงูุฏูุฑู ุงูุฅุณุจุงูู": {
                "leagueLogo": "https://www.laliga.com/assets/img/logos/laliga-v.svg",
                "teams": {
                    "ุฑูุงู ูุฏุฑูุฏ": "https://www.laliga.com/assets/img/logos/real-madrid.svg",
                    "ุจุฑุดูููุฉ": "https://www.laliga.com/assets/img/logos/barcelona.svg",
                    "ุฃุชูุชููู ูุฏุฑูุฏ": "https://www.laliga.com/assets/img/logos/atletico-madrid.svg"
                }
            },
            "ุฏูุฑู ุฃุจุทุงู ุฃูุฑูุจุง": {
                "leagueLogo": "https://img.uefa.com/imgml/2019/ucl/badges/100x100/ucl-2019-badge.png",
                "teams": {
                    "ุจุงูุฑู ููููุฎ": "https://img.uefa.com/imgml/2019/ucl/badges/100x100/bayern.png",
                    "ุจุงุฑูุณ ุณุงู ุฌูุฑูุงู": "https://img.uefa.com/imgml/2019/ucl/badges/100x100/paris.png"
                }
            }
        };

        // ูุธุงู ุงูุชุนุจุฆุฉ ุงูุชููุงุฆูุฉ ูููุฑู ูุงูุดุนุงุฑุงุช
        function setupAutoLogoFill() {
            const leagueInput = document.getElementById('league');
            const team1Input = document.getElementById('team1');
            const team2Input = document.getElementById('team2');
            
            const inputs = [leagueInput, team1Input, team2Input];

            inputs.forEach(input => {
                const suggestionsBox = document.getElementById(input.id + '-suggestions');
                const dataType = input.getAttribute('data-type');

                input.addEventListener('input', function() {
                    const query = this.value.trim().toLowerCase();
                    suggestionsBox.innerHTML = '';
                    suggestionsBox.style.display = 'none';
                    if (query.length === 0) return;

                    let suggestions = [];

                    if (dataType === 'league') {
                        suggestions = Object.keys(TEAMS_DATABASE)
                            .filter(l => l.toLowerCase().includes(query))
                            .map(l => ({ name: l, logo: TEAMS_DATABASE[l].leagueLogo }));
                    } else if (dataType === 'team1' || dataType === 'team2') {
                        const currentLeague = leagueInput.value;
                        if (currentLeague && TEAMS_DATABASE[currentLeague]) {
                            suggestions = Object.keys(TEAMS_DATABASE[currentLeague].teams)
                                .filter(t => t.toLowerCase().includes(query))
                                .map(t => ({ name: t, logo: TEAMS_DATABASE[currentLeague].teams[t] }));
                        } else {
                            // ุงูุจุญุซ ูู ูู ุงููุฑู ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ุฏูุฑู
                            Object.values(TEAMS_DATABASE).forEach(leagueData => {
                                Object.keys(leagueData.teams).forEach(t => {
                                    if (t.toLowerCase().includes(query)) {
                                        suggestions.push({ name: t, logo: leagueData.teams[t] });
                                    }
                                });
                            });
                        }
                    }

                    if (suggestions.length > 0) {
                        suggestionsBox.style.display = 'block';
                        suggestions.slice(0, 5).forEach(suggestion => {
                            const item = document.createElement('div');
                            item.className = 'suggestion-item';
                            item.innerHTML = `<img src="${suggestion.logo}" alt="${suggestion.name}"><span>${suggestion.name}</span>`;
                            item.addEventListener('click', function() {
                                input.value = suggestion.name;
                                suggestionsBox.innerHTML = '';
                                suggestionsBox.style.display = 'none';
                                
                                // ุชุญุฏูุซ ุงูุดุนุงุฑ ุงูููุงุจู
                                if (dataType === 'league') {
                                    document.getElementById('league-logo').value = suggestion.logo;
                                    document.getElementById('league-preview').src = suggestion.logo;
                                } else if (dataType === 'team1') {
                                    document.getElementById('team1-logo').value = suggestion.logo;
                                    document.getElementById('team1-preview').src = suggestion.logo;
                                } else if (dataType === 'team2') {
                                    document.getElementById('team2-logo').value = suggestion.logo;
                                    document.getElementById('team2-preview').src = suggestion.logo;
                                }
                            });
                            suggestionsBox.appendChild(item);
                        });
                    }
                });

                // ุฅุฎูุงุก ุงูุตูุฏูู ุนูุฏ ููุฏุงู ุงูุชุฑููุฒ (ูุน ุชุฃุฎูุฑ ููุณูุงุญ ุจุงูููุฑ ุนูู ุงูุนูุงุตุฑ)
                input.addEventListener('blur', function() {
                    setTimeout(() => {
                        suggestionsBox.style.display = 'none';
                    }, 200);
                });
                
                // ุชุญุฏูุซ ุงููุนุงููุฉ ุนูุฏ ุชุบููุฑ ุญูู ุงูุดุนุงุฑ ูุฏููุงู
                document.getElementById(input.id + '-logo')?.addEventListener('input', function() {
                    document.getElementById(input.id + '-preview').src = this.value || 'https://via.placeholder.com/40?text=Logo';
                });
            });
        }
    </script>
</body>
</html>
